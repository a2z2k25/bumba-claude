# /bumba:checkpoint - Comprehensive Team Commit

## 🏁 Advanced Analysis & Team Coordination

**Purpose**: Full analysis commits with team context, descriptive messaging, and quality validation for professional development workflows.

**Usage Examples**:

```bash
/bumba:checkpoint                               # Full analysis of all changes
/bumba:checkpoint "Custom commit message"       # Custom message with analysis
/bumba:checkpoint file1.js file2.py            # Specific files with analysis
/bumba:checkpoint "Fix bug" src/main.js         # Custom message + specific files
```

---

## **Comprehensive Analysis Workflow**

### **1. Parse Arguments & Setup**

```bash
# Parse command arguments for files and messages
ARGUMENTS="$ARGUMENTS"

# Determine if files are specified
if [[ "$ARGUMENTS" =~ \.(js|py|md|json|sh|css|html|tsx|ts)$ ]]; then
    FILES_SPECIFIED=true
    FILES=$(echo "$ARGUMENTS" | grep -oE '[^\s]*\.[a-zA-Z0-9]+')
    CUSTOM_MESSAGE=$(echo "$ARGUMENTS" | sed -E 's/[^\s]*\.[a-zA-Z0-9]+//g' | xargs)
else
    FILES_SPECIFIED=false
    CUSTOM_MESSAGE="$ARGUMENTS"
fi

echo "🏁 BUMBA Checkpoint Analysis Starting..."
```

### **2. Comprehensive Change Analysis**

```bash
# Check current git status
echo "🏁 Analyzing current changes..."
git status --porcelain

# Get detailed diff for commit message generation
CHANGED_FILES=$(git diff --name-only)
STAGED_FILES=$(git diff --cached --name-only)
UNTRACKED_FILES=$(git ls-files --others --exclude-standard)

if [ -z "$CHANGED_FILES" ] && [ -z "$STAGED_FILES" ] && [ -z "$UNTRACKED_FILES" ]; then
    echo "🏁 No changes to checkpoint"
    exit 0
fi

echo "🏁 Changes detected - proceeding with analysis..."
```

### **3. Team Context Integration**

```bash
# Check for team collaboration context
TEAM_CONTEXT=""
if [ -f ".bumba/team-context.json" ]; then
    LAST_AGENT=$(jq -r '.lastAgent // "unknown"' .bumba/team-context.json)
    TEAM_CONTEXT="[${LAST_AGENT}→checkpoint]"
fi

# Analyze change patterns for intelligent commit message
CHANGE_SUMMARY=""
if echo "$CHANGED_FILES" | grep -q "\.tsx\?$\|\.jsx\?$"; then
    CHANGE_SUMMARY="${CHANGE_SUMMARY}Frontend "
fi
if echo "$CHANGED_FILES" | grep -q "\.py$\|\.java$\|\.go$"; then
    CHANGE_SUMMARY="${CHANGE_SUMMARY}Backend "
fi
if echo "$CHANGED_FILES" | grep -q "\.md$\|README"; then
    CHANGE_SUMMARY="${CHANGE_SUMMARY}Documentation "
fi
if echo "$CHANGED_FILES" | grep -q "test\|spec"; then
    CHANGE_SUMMARY="${CHANGE_SUMMARY}Tests "
fi
```

### **4. Quality Gate Integration**

```bash
# Run BUMBA quality checks before committing
echo "🏁 Running BUMBA quality validation..."

# Check if quality hooks exist and run them
if [ -f "~/.claude/hooks/pre-execution-scan.sh" ]; then
    echo "🏁 Running pre-execution quality scan..."
    ~/.claude/hooks/pre-execution-scan.sh || {
        echo "🏁 Quality gate failed - fix issues before checkpoint"
        exit 1
    }
fi

echo "🏁 Quality validation passed"
```

### **5. Intelligent File Staging**

```bash
# Stage files based on arguments and analysis
if [ "$FILES_SPECIFIED" = true ]; then
    echo "🏁 Staging specified files: $FILES"
    git add $FILES
else
    echo "🏁 Staging all changes for comprehensive checkpoint"
    # Stage modified and untracked files
    git add $(git diff --name-only) $(git diff --cached --name-only) $(git ls-files --others --exclude-standard) 2>/dev/null || true
fi

# Verify something was staged
STAGED_COUNT=$(git diff --cached --name-only | wc -l)
if [ $STAGED_COUNT -eq 0 ]; then
    echo "🏁 No files staged for commit"
    exit 1
fi

echo "🏁 $STAGED_COUNT files staged for checkpoint"
```

### **6. Intelligent Commit Message Generation**

```bash
# Generate descriptive commit message
if [ -n "$CUSTOM_MESSAGE" ]; then
    COMMIT_SUBJECT="$CUSTOM_MESSAGE"
else
    # Auto-generate based on changes
    if [ -n "$CHANGE_SUMMARY" ]; then
        COMMIT_SUBJECT="Update ${CHANGE_SUMMARY}components and functionality"
    else
        COMMIT_SUBJECT="Checkpoint: Development progress update"
    fi
fi

# Add team context if available
if [ -n "$TEAM_CONTEXT" ]; then
    COMMIT_SUBJECT="${TEAM_CONTEXT} ${COMMIT_SUBJECT}"
fi

# Create detailed commit body
COMMIT_BODY=""
if [ -n "$CHANGED_FILES" ]; then
    COMMIT_BODY="${COMMIT_BODY}Modified files:\n$(echo "$CHANGED_FILES" | sed 's/^/- /')\n\n"
fi
if [ -n "$UNTRACKED_FILES" ]; then
    COMMIT_BODY="${COMMIT_BODY}New files:\n$(echo "$UNTRACKED_FILES" | sed 's/^/- /')\n\n"
fi

# Add timestamp and framework info
COMMIT_BODY="${COMMIT_BODY}Generated by BUMBA Framework v1.0.0\nCheckpoint: $(date '+%Y-%m-%d %H:%M:%S')"
```

### **7. Create Professional Commit**

```bash
# Create commit with descriptive message
if [ -n "$COMMIT_BODY" ]; then
    git commit -m "$COMMIT_SUBJECT" -m "$COMMIT_BODY" || {
        echo "🏁 Checkpoint commit failed"
        exit 1
    }
else
    git commit -m "$COMMIT_SUBJECT" || {
        echo "🏁 Checkpoint commit failed"
        exit 1
    }
fi

echo "🏁 Checkpoint created successfully"
```

### **8. Team Coordination Update**

```bash
# Update team context for next agent
mkdir -p .bumba
cat > .bumba/team-context.json << EOF
{
    "lastCheckpoint": "$(date -Iseconds)",
    "lastAgent": "checkpoint-system",
    "commitHash": "$(git rev-parse HEAD)",
    "filesChanged": $STAGED_COUNT,
    "summary": "$COMMIT_SUBJECT"
}
EOF

echo "🏁 Team context updated for collaboration"
```

### **9. Summary & Next Steps**

```bash
# Show checkpoint summary
echo ""
echo "🏁 Checkpoint Summary:"
git log -1 --stat

echo ""
echo "🏁 Ready for team collaboration or publishing"
echo "🏁 Next steps:"
echo "   • Continue development with other agents"
echo "   • Use /bumba:publish to push to GitHub"
echo "   • Use /bumba:commit for quick updates"
```

---

## **Team Collaboration Features**

### **Multi-Agent Coordination**

- **Team context tracking** for agent handoffs
- **Shared checkpoint state** across agents
- **Collaboration history** in commit messages
- **Agent workflow integration**

### **Quality Assurance**

- **Pre-commit quality gates** integration
- **BUMBA hook system** validation
- **Code quality enforcement** before checkpoints
- **Professional commit standards**

### **Professional Development**

- **Descriptive commit messages** following best practices
- **Comprehensive change analysis**
- **File categorization** and staging intelligence
- **Version control excellence**

---

**🏁 Pro Tip**: Use checkpoints for major milestones, agent handoffs, and before publishing. Integrates seamlessly with BUMBA's quality gates and team workflows.
